From a8e909dc8bc3c833cb186bb0da8b68e06d2a9b23 Mon Sep 17 00:00:00 2001
From: chalesyu <574249312@qq.com>
Date: Sat, 13 Feb 2021 00:00:00 +0800
Subject: [PATCH 1/6] h6:fix uart over sd card solt

---
 arch/arm/mach-sunxi/board.c | 11 ++++++++---
 board/sunxi/board.c         |  4 +++-
 2 files changed, 11 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-sunxi/board.c b/arch/arm/mach-sunxi/board.c
index fa2b6fcfd6..19db406ad5 100644
--- a/arch/arm/mach-sunxi/board.c
+++ b/arch/arm/mach-sunxi/board.c
@@ -113,9 +113,14 @@ static int gpio_init(void)
 	sunxi_gpio_set_cfgpin(SUNXI_GPB(9), SUN50I_GPB_UART0);
 	sunxi_gpio_set_pull(SUNXI_GPB(9), SUNXI_GPIO_PULL_UP);
 #elif CONFIG_CONS_INDEX == 1 && defined(CONFIG_MACH_SUN50I_H6)
-	sunxi_gpio_set_cfgpin(SUNXI_GPH(0), SUN50I_H6_GPH_UART0);
-	sunxi_gpio_set_cfgpin(SUNXI_GPH(1), SUN50I_H6_GPH_UART0);
-	sunxi_gpio_set_pull(SUNXI_GPH(1), SUNXI_GPIO_PULL_UP);
+	/* disable GPH0,1 as uart0 tx,rx to avoid conflict */
+	sunxi_gpio_set_cfgpin(SUNXI_GPH(0), SUNXI_GPIO_INPUT);
+	sunxi_gpio_set_cfgpin(SUNXI_GPH(1), SUNXI_GPIO_INPUT);
+	sunxi_gpio_set_cfgpin(SUNXI_GPF(2), SUN8I_GPF_UART0);
+	sunxi_gpio_set_cfgpin(SUNXI_GPF(4), SUN8I_GPF_UART0);
+	sunxi_gpio_set_pull(SUNXI_GPF(4), SUNXI_GPIO_PULL_UP);
+	sunxi_gpio_set_pull(SUNXI_GPL(4), SUNXI_GPIO_PULL_UP); /* Power led */
+	sunxi_gpio_set_pull(SUNXI_GPL(5), SUNXI_GPIO_PULL_UP); /* USB Power */
 #elif CONFIG_CONS_INDEX == 1 && defined(CONFIG_MACH_SUN50I_H616)
 	sunxi_gpio_set_cfgpin(SUNXI_GPH(0), SUN50I_H616_GPH_UART0);
 	sunxi_gpio_set_cfgpin(SUNXI_GPH(1), SUN50I_H616_GPH_UART0);
diff --git a/board/sunxi/board.c b/board/sunxi/board.c
index 21651a1bfc..b2af49c475 100644
--- a/board/sunxi/board.c
+++ b/board/sunxi/board.c
@@ -418,13 +418,15 @@ static void mmc_pinmux_setup(int sdc)
 	switch (sdc) {
 	case 0:
 		/* SDC0: PF0-PF5 */
+/*
+//This variant board doesn't have SD card port
 		for (pin = SUNXI_GPF(0); pin <= SUNXI_GPF(5); pin++) {
 			sunxi_gpio_set_cfgpin(pin, SUNXI_GPF_SDC0);
 			sunxi_gpio_set_pull(pin, SUNXI_GPIO_PULL_UP);
 			sunxi_gpio_set_drv(pin, 2);
 		}
+*/
 		break;
-
 	case 1:
 		pins = sunxi_name_to_gpio_bank(CONFIG_MMC1_PINS);
 
-- 

